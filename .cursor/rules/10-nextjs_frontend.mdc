---
title: Next.js 15 + React 19 Frontend
description: Next.js 15 + React 19 â€” regler og best practices for Huddle frontend (App Router + API Routes)
owner: web@huddle
severity: warn
globs: "apps/web/app/**, apps/web/components/**, apps/web/lib/**"
last_review: 2025-11-25
next_review: 2026-01-01
---

## Purpose
- Server-first patterns, data fetching on server, clear client-only boundaries, file/routing structure, metadata/SEO, images/assets, runtime choices.
- Monorepo structure: `apps/web/` contains Next.js app with both UI and API routes (`app/api/v1/...`).

## Component types
- Server by default. Use `"use client"` only when interactivity is required. Keep business logic out of client components.
- API routes live in `apps/web/app/api/v1/...` using Next.js route handlers (not separate backend service).

## Data fetching
- Use Server Actions and server components for fetching/mutations. Centralize API calls in `lib/services/*` or call Next.js API routes.
- For API routes: use `@supabase/supabase-js` server-side with service role key; use `@clerk/backend` for auth verification.
- Return `{ data, error }` or standard JSON responses per `05-API_Design.md`.

### Bad
```
"use client";
import { getData } from "@/lib/services/api";
export default async function Page() {
  const data = await getData(); // client fetch + await
  return <List items={data} />;
}
```

### Good
```
import { getData } from "@/lib/services/api";
export default async function Page() {
  const data = await getData(); // server fetch
  return <List items={data} />;
}
```

## Caching and revalidation
- Use cache for public, slow-changing data (jerseys, profiles); revalidate for marketplace listings/auctions; `no-store` for user/checkout data; avoid double-fetch.

### Autofix
- Move duplicated child fetches up to parent; pass props down.
- Add `export const revalidate = <seconds>` for ISR where suitable (public jersey feeds, user profiles).

## Routing and structure
- App Router only; organize by features/segments. Keep nesting shallow. Use `next/link` for internal navigation.
- API routes: `apps/web/app/api/v1/jerseys/route.ts` for GET/POST, `apps/web/app/api/v1/jerseys/[id]/route.ts` for GET/PATCH/DELETE.

## Styling and UI
- Tailwind CSS + Radix UI (headless primitives); use `clsx`/`cn()`; build composable primitives and feature components; maintain contrast and focus states.
- Dark theme by default (Sorare-inspired sports aesthetic).

## Performance
- Prefer streamed SSR; lazy/split large components with `Suspense`; keep client bundle slim; use React 19 compiler defaults.
- Use TanStack Query (React Query) for client-side data management and caching.

## Integrations
- Supabase: server-side via `lib/supabase-server.ts` with service role; client-side via `@supabase/supabase-js` with anon key for RLS.
- Clerk: use `@clerk/nextjs` for frontend auth, `@clerk/backend` for API route verification.
- MedusaJS: call via `lib/services/medusa.ts` when integrated (Phase 4+).
- Stripe: server-side only via API routes.
- Sentry: root error boundary without PII.

## State management
- TanStack Query for server state (caching, refetch, mutations).
- React Hook Form + Zod for forms (see `12-forms_actions_validation.mdc`).
- Context API for minimal global UI state (auth context, theme).

## DoD (Definition of Done)
- No client-only secrets; server actions/API routes for mutations; no duplicate fetch; LCP sane; a11y checks pass.
- API routes follow patterns from `05-API_Design.md` and `06-Backend_Guide.md`.

